<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Always Us</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Base Settings */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }
        
        .font-serif {
            font-family: 'Playfair Display', serif;
        }

        /* Glassmorphism Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        /* Animations */
        .stage {
            display: none;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }
        
        .stage.active {
            display: flex;
            opacity: 1;
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }

        @keyframes drawPath {
            0% { stroke-dashoffset: 1000; }
            100% { stroke-dashoffset: 0; }
        }

        .draw-animation {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawPath 4s ease-out forwards;
        }

        /* Utility for hiding scrollbar but keeping functionality if needed */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.4",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/",
    "framer-motion": "https://esm.sh/framer-motion@^12.29.2",
    "lucide-react": "https://esm.sh/lucide-react@^0.563.0",
    "canvas-confetti": "https://esm.sh/canvas-confetti@^1.9.4"
  }
}
</script>
</head>
<body class="text-white selection:bg-rose-500/30">

    <!-- ================= BACKGROUND LAYERS ================= -->
    <div class="fixed inset-0 -z-10 overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-indigo-950 via-purple-950 to-slate-950 opacity-90"></div>
        
        <!-- Animated Orbs (CSS Animation) -->
        <div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-rose-500/20 rounded-full blur-[100px] animate-float" style="animation-duration: 15s;"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[600px] h-[600px] bg-indigo-500/20 rounded-full blur-[100px] animate-float" style="animation-delay: 2s; animation-duration: 18s;"></div>
        <div class="absolute top-[40%] left-[30%] w-[300px] h-[300px] bg-purple-400/20 rounded-full blur-[80px] animate-float" style="animation-delay: 4s; animation-duration: 20s;"></div>
    </div>

    <!-- ================= AUDIO PLAYER ================= -->
    <audio id="bg-music" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/10/25/audio_244f77c4a1.mp3?filename=gentle-piano-124021.mp3" type="audio/mpeg">
    </audio>
    <button onclick="toggleMusic()" id="music-btn" class="fixed top-6 right-6 z-50 p-3 rounded-full bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 text-white transition-all">
        <i data-lucide="volume-x" id="music-icon"></i>
    </button>

    <!-- ================= MAIN CONTENT ================= -->
    <main class="relative z-10 min-h-screen w-full">

        <!-- STAGE 1: INTRO -->
        <div id="stage-intro" class="stage active flex-col items-center justify-center min-h-screen px-6 text-center">
            <div class="glass-card p-8 md:p-12 rounded-3xl max-w-2xl w-full transform transition-all duration-1000 translate-y-0 opacity-100">
                <div class="flex justify-center mb-6">
                    <div class="p-3 bg-white/10 rounded-full">
                        <i data-lucide="heart" class="w-8 h-8 text-rose-300 fill-rose-300/50"></i>
                    </div>
                </div>
                
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-serif mb-6 text-transparent bg-clip-text bg-gradient-to-r from-rose-100 to-purple-200">
                    I'm Sorry
                </h1>
                
                <div class="space-y-4 text-lg md:text-xl text-gray-200 font-light leading-relaxed mb-8">
                    <p>
                        Sometimes words aren't enough to express how much I value what we have.
                        Distance makes things harder, but it also makes every moment matter more.
                    </p>
                    <p>
                        I messed up, and I want to make it right. Not just because it's Valentine's, 
                        but because it's <span class="font-serif italic text-rose-200">us</span>.
                    </p>
                </div>

                <button onclick="nextStage()" class="px-8 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-full text-white font-medium tracking-wide transition-all duration-300 group">
                    Let me show you <span class="inline-block transition-transform group-hover:translate-x-1">‚Üí</span>
                </button>
            </div>
        </div>

        <!-- STAGE 2: DISTANCE MAP -->
        <div id="stage-distance" class="stage flex-col items-center justify-center min-h-screen px-4">
            <div class="glass-card w-full max-w-4xl p-6 md:p-10 rounded-3xl flex flex-col items-center">
                <h2 class="text-3xl md:text-4xl font-serif mb-2 text-center text-rose-100">Miles Apart, Heart Connected</h2>
                <p class="text-white/60 text-center mb-8 max-w-lg">From Lagos to Kigali, no distance is too great for the way I feel about you.</p>

                <div class="relative w-full aspect-[4/3] md:aspect-[2/1] bg-black/20 rounded-2xl overflow-hidden border border-white/5">
                    <!-- Background Grid -->
                    <div class="absolute inset-0" style="background-image: radial-gradient(rgba(255,255,255,0.1) 1px, transparent 1px); background-size: 20px 20px;"></div>
                    
                    <!-- SVG Map -->
                    <svg class="absolute inset-0 w-full h-full p-10" viewBox="0 0 100 100" preserveAspectRatio="none">
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stopColor="#ec4899" />
                                <stop offset="100%" stopColor="#8b5cf6" />
                            </linearGradient>
                            <filter id="glow">
                                <feGaussianBlur stdDeviation="1" result="coloredBlur"/>
                                <feMerge>
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/>
                                </feMerge>
                            </filter>
                        </defs>
                        
                        <!-- Path line -->
                        <path id="map-path" d="M 20 30 Q 60 20 80 70" fill="none" stroke="url(#gradient)" stroke-width="0.5" stroke-dasharray="4 2" />
                        
                        <!-- Moving Heart -->
                        <circle r="1.5" fill="#ec4899" filter="url(#glow)">
                            <animateMotion dur="3s" repeatCount="indefinite" path="M 20 30 Q 60 20 80 70" rotate="auto" />
                        </circle>
                    </svg>

                    <!-- Markers -->
                    <div class="absolute left-[20%] top-[30%] -translate-x-1/2 -translate-y-1/2 flex flex-col items-center">
                        <i data-lucide="map-pin" class="text-rose-400 w-8 h-8 drop-shadow-[0_0_10px_rgba(236,72,153,0.8)]"></i>
                        <span class="text-xs font-bold mt-1 tracking-wider text-rose-200">LAGOS</span>
                    </div>

                    <div class="absolute left-[80%] top-[70%] -translate-x-1/2 -translate-y-1/2 flex flex-col items-center">
                        <i data-lucide="map-pin" class="text-purple-400 w-8 h-8 drop-shadow-[0_0_10px_rgba(139,92,246,0.8)]"></i>
                        <span class="text-xs font-bold mt-1 tracking-wider text-purple-200">KIGALI</span>
                    </div>
                </div>

                <button onclick="nextStage()" class="mt-8 px-8 py-3 bg-white/10 hover:bg-white/20 border border-white/20 rounded-full text-white font-medium tracking-wide transition-all duration-300">
                    Remember Us?
                </button>
            </div>
        </div>

        <!-- STAGE 3: MEMORY CAROUSEL -->
        <div id="stage-memories" class="stage flex-col items-center justify-center min-h-screen px-4 py-20">
            <div class="w-full max-w-4xl">
                <h2 class="text-3xl md:text-5xl font-serif text-center mb-10 text-transparent bg-clip-text bg-gradient-to-r from-rose-200 to-purple-200">
                    Our Memory Lane
                </h2>

                <div class="relative glass-card p-4 md:p-6 rounded-3xl aspect-[4/5] md:aspect-video flex items-center justify-center overflow-hidden">
                    
                    <!-- Image Container -->
                    <div class="w-full h-full relative rounded-2xl overflow-hidden shadow-2xl bg-black/40 flex items-center justify-center">
                        <img id="memory-img" src="" alt="Memory" class="w-full h-full object-cover transition-opacity duration-500 opacity-100" referrerPolicy="no-referrer">
                        
                        <!-- Caption Overlay -->
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent p-6 pt-20">
                            <p id="memory-caption" class="text-lg md:text-xl font-light text-center text-white font-serif italic">
                                "Caption goes here"
                            </p>
                        </div>
                    </div>

                    <!-- Controls -->
                    <button onclick="prevMemory()" class="absolute left-4 md:left-8 top-1/2 -translate-y-1/2 p-3 rounded-full bg-black/20 hover:bg-black/40 backdrop-blur-sm text-white transition-all z-20">
                        <i data-lucide="chevron-left"></i>
                    </button>
                    <button onclick="nextMemory()" class="absolute right-4 md:right-8 top-1/2 -translate-y-1/2 p-3 rounded-full bg-black/20 hover:bg-black/40 backdrop-blur-sm text-white transition-all z-20">
                        <i data-lucide="chevron-right"></i>
                    </button>
                </div>
                
                <div class="flex justify-center mt-10">
                     <button onclick="nextStage()" class="px-8 py-3 bg-gradient-to-r from-rose-500/80 to-purple-600/80 hover:from-rose-500 hover:to-purple-600 rounded-full text-white font-medium shadow-lg shadow-rose-500/20 backdrop-blur-sm transition-all transform hover:scale-105">
                        One Last Question...
                    </button>
                </div>
            </div>
        </div>

        <!-- STAGE 4: PROPOSAL -->
        <div id="stage-proposal" class="stage flex-col items-center justify-center min-h-screen px-4 overflow-hidden">
            <div id="proposal-card" class="glass-card p-10 md:p-16 rounded-[3rem] text-center max-w-2xl w-full relative transition-all duration-500">
                <h2 class="text-4xl md:text-6xl font-serif mb-8 text-rose-100 drop-shadow-lg">
                    Will you be my Valentine?
                </h2>
                <p class="text-lg text-white/80 mb-12 font-light">
                    I promise to make up for every mile between us.
                </p>

                <div class="flex flex-col md:flex-row items-center justify-center gap-6 relative min-h-[100px] w-full">
                    <!-- Yes Button -->
                    <button onclick="handleYes()" class="px-12 py-4 bg-gradient-to-r from-rose-500 to-pink-600 rounded-full text-white text-xl font-bold shadow-[0_0_30px_rgba(225,29,72,0.6)] hover:shadow-[0_0_50px_rgba(225,29,72,0.8)] transition-all transform hover:scale-110 z-20">
                        YES! üíñ
                    </button>

                    <!-- Runaway No Button -->
                    <button id="no-btn" onmouseover="moveNoButton()" ontouchstart="moveNoButton()" onclick="moveNoButton()" class="px-12 py-4 bg-white/10 border border-white/20 rounded-full text-white/70 text-xl font-medium backdrop-blur-md hover:bg-white/20 transition-all z-10 relative duration-300">
                        No
                    </button>
                </div>
            </div>
        </div>

        <!-- STAGE 5: ACCEPTED -->
        <div id="stage-accepted" class="stage flex-col items-center justify-center min-h-screen text-center px-4">
            <div class="glass-card p-12 rounded-full mb-8 bg-rose-500/20 border-rose-400/30 transform animate-bounce">
                <h1 class="text-5xl md:text-8xl">ü•∞</h1>
            </div>
            <h1 class="text-4xl md:text-6xl font-serif text-white mb-6 animate-pulse">
                See you soon, my love.
            </h1>
            <p class="text-xl text-rose-200">Checking flights to Kigali... ‚úàÔ∏è</p>
        </div>

    </main>

    <!-- Progress Dots -->
    <div id="progress-dots" class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 flex space-x-2">
        <div class="h-1 w-8 bg-rose-400 rounded-full transition-all duration-500"></div>
        <div class="h-1 w-2 bg-white/20 rounded-full transition-all duration-500"></div>
        <div class="h-1 w-2 bg-white/20 rounded-full transition-all duration-500"></div>
        <div class="h-1 w-2 bg-white/20 rounded-full transition-all duration-500"></div>
    </div>

    <!-- ================= JAVASCRIPT LOGIC ================= -->
    <script>
        // Initialize Icons
        lucide.createIcons();

        // --- STATE MANAGEMENT ---
        let currentStageIndex = 0;
        const stages = [
            'stage-intro',
            'stage-distance',
            'stage-memories',
            'stage-proposal',
            'stage-accepted'
        ];

        // --- GOOGLE DRIVE IMAGE FIXER ---
        const memories = [
            { 
                id: 1, 
                url: 'https://drive.google.com/file/d/1-VJmTekPEtbNUzVCbGX6i3ENlaXixPI0/view?usp=drive_link', 
                caption: 'The Last day i saw you.' 
            },
            { 
                id: 2, 
                url: 'https://drive.google.com/uc?export=view&id=1OWXPZbVWR-_mHF_WNMBuovQPbYiqVpi0', 
                caption: 'Your birthday last year.' 
            },
            { 
                id: 3, 
                url: 'https://drive.google.com/uc?export=view&id=1Y0EmH2FeKHExfwlV9Ts_uGfwabQAWYaI', 
                caption: 'Thinking of you always.' 
            },
            { 
                id: 4, 
                url: 'https://images.unsplash.com/photo-1516589178581-6cd7833ae3b2?q=80&w=1920&auto=format&fit=crop', 
                caption: 'Can‚Äôt wait to see this view with you.' 
            },
        ];

        let currentMemoryIndex = 0;

        function getImageUrl(url) {
            if (url.match(/\.(jpeg|jpg|gif|png|webp)$/i) || url.includes('unsplash.com')) {
                return url;
            }

            if (url.includes('drive.google.com')) {
                let id = '';
                const fileMatch = url.match(/\/file\/d\/([^/]+)/);
                if (fileMatch && fileMatch[1]) id = fileMatch[1];
                
                const idMatch = url.match(/[?&]id=([^&]+)/);
                if (!id && idMatch && idMatch[1]) id = idMatch[1];

                if (id) {
                    return `https://drive.google.com/thumbnail?id=${id}&sz=w1920`;
                }
            }
            return url;
        }

        function updateMemoryDisplay() {
            const imgEl = document.getElementById('memory-img');
            const captionEl = document.getElementById('memory-caption');
            const memory = memories[currentMemoryIndex];
            
            // Fade out
            imgEl.style.opacity = '0';
            
            setTimeout(() => {
                imgEl.src = getImageUrl(memory.url);
                captionEl.textContent = `"${memory.caption}"`;
                // Fade in after src change
                imgEl.onload = () => { imgEl.style.opacity = '1'; };
            }, 300);
        }

        function nextMemory() {
            currentMemoryIndex = (currentMemoryIndex + 1) % memories.length;
            updateMemoryDisplay();
        }

        function prevMemory() {
            currentMemoryIndex = (currentMemoryIndex - 1 + memories.length) % memories.length;
            updateMemoryDisplay();
        }

        // Initialize first memory
        updateMemoryDisplay();


        // --- NAVIGATION ---
        function updateProgressDots() {
            const dots = document.getElementById('progress-dots').children;
            const isAccepted = currentStageIndex === 4;
            
            if (isAccepted) {
                document.getElementById('progress-dots').style.display = 'none';
                return;
            }

            for(let i=0; i<dots.length; i++) {
                if (i <= currentStageIndex) {
                    dots[i].className = 'h-1 w-8 bg-rose-400 rounded-full transition-all duration-500';
                } else {
                    dots[i].className = 'h-1 w-2 bg-white/20 rounded-full transition-all duration-500';
                }
            }
        }

        function showStage(index) {
            // Hide all
            stages.forEach(id => {
                const el = document.getElementById(id);
                el.classList.remove('active');
                setTimeout(() => {
                    if(!el.classList.contains('active')) el.style.display = 'none';
                }, 800); // Wait for opacity transition
            });

            // Show current
            const nextEl = document.getElementById(stages[index]);
            nextEl.style.display = 'flex';
            // Slight delay to allow display:flex to apply before opacity transition
            setTimeout(() => {
                nextEl.classList.add('active');
                
                // Trigger specific stage animations
                if(stages[index] === 'stage-distance') {
                    const path = document.getElementById('map-path');
                    // Reset animation
                    path.style.animation = 'none';
                    path.offsetHeight; /* trigger reflow */
                    path.style.animation = 'drawPath 4s ease-out forwards';
                }
            }, 50);

            currentStageIndex = index;
            updateProgressDots();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function nextStage() {
            if (currentStageIndex < stages.length - 1) {
                showStage(currentStageIndex + 1);
            }
        }


        // --- INTERACTIVE ELEMENTS ---

        // Music
        let isPlaying = false;
        function toggleMusic() {
            const audio = document.getElementById('bg-music');
            const icon = document.getElementById('music-icon');
            
            if (isPlaying) {
                audio.pause();
                icon.setAttribute('data-lucide', 'volume-x');
            } else {
                audio.play().catch(e => console.log("Audio play failed (user interaction required first)"));
                icon.setAttribute('data-lucide', 'volume-2');
            }
            lucide.createIcons(); // Refresh icon
            isPlaying = !isPlaying;
        }

        // Runaway Button
        function moveNoButton() {
            const btn = document.getElementById('no-btn');
            const container = document.getElementById('proposal-card');
            
            // Get dimensions
            const containerRect = container.getBoundingClientRect();
            const btnRect = btn.getBoundingClientRect();

            // Calculate max boundaries relative to container
            // We want the button to stay INSIDE the card so it doesn't get lost
            const padding = 20;
            const maxX = containerRect.width - btnRect.width - padding;
            const maxY = containerRect.height - btnRect.height - padding;
            
            const randomX = Math.random() * maxX - (maxX / 2);
            const randomY = Math.random() * maxY - (maxY / 2);
            
            btn.style.position = 'absolute';
            btn.style.transform = `translate(${randomX}px, ${randomY}px)`;
        }

        // Yes / Confetti
        function handleYes() {
            // Fire confetti
            const duration = 5 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            const randomInRange = (min, max) => Math.random() * (max - min) + min;

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                const particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
            }, 250);

            nextStage();
        }

    </script>
</body>
</html>